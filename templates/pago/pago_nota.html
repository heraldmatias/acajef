{% extends 'base.html' %}
{% block title %}W.V.B. - Subsanar{% endblock %}
{% block csspage %}
	<style>
		#id_alumno{
			width: 97.8%;
		}
		.ui-autocomplete-loading { background: white url('{{ STATIC_URL }}images/ui-anim_basic_16x16.gif') right center no-repeat; }
	</style>
{% endblock %}
{% block content %}
	<form method="post" action="/wvb/form/pago-subsanar/" class="yform full" role="application" onSubmit="if(!confirmar()) return false;">
		{% csrf_token %}
		<fieldset>
		<legend>Pensión</legend>
		<div class="subcolumns">
			<div class="c50l">
				<div class="subcl">
					<div class="subcl type-text">
						{{ codigo.errors }}
						<label for="id_codigo_alumno">Codigo Alumno:</label>
						<input type="text" id="id_codigo_alumno" name="codigo_alumno" maxlength="6" onkeypress="if(event.keyCode==13){getCampus(this.value);return false;}"/>
					</div>
				</div>
			</div>
			<div class="c50r">
				<div class="subcl type-text">
					{{ serie.errors }}
					<label for="id_boleta">Boleta:</label>
					<input type="text" id="id_boleta" name="codigo_boleta" value="{{ numero_serie.serie }}-{{ numero_serie.numero }}"readonly="readonly"/>
				</div>
			</div>
			<div class="subcolumns">
				<div class="subcl type-text">
					{{ alumno.errors }}
					<label for="id_alumno">Alumno:</label>
					<input type="text" id="id_alumno" name="alumno" readonly="readonly"/>
				</div>
			<div>
			<div class="c50l">
				<div class="subcl type-text">
					{{ boleta_form.concepto.errors }}
					<label for="id_concepto">Concepto:</label>
					<input type="text" name="concepto" id="id_concepto" readonly="readonly" value="Pensión"/>
				</div>
				<div class="subcl type-text">
					{{ boleta_form.fecha_emision.errors }}
					<label for="id_fecha_emision">Fecha Emisión:</label>
					<input type="text" name="fecha_emision" id="id_fecha_emision" readonly="readonly"/>
				</div>
				<div class="subcl type-text">
					{{ boleta_form.monto.errors }}
					<label for="id_monto">Importe:</label>
					<input type="text" name="monto" id="id_monto" value="0.0"/>
				</div>
				<div class="subcl type-text">
					{{ boleta_form.saldo.errors }}
					<label for="id_saldo">Saldo:</label>
					<input type="text" name="saldo" id="id_saldo" readonly="readonly" value="0"/>
				</div>
			</div>
			<div class="c50r">
				<div class="subcl type-text">
					{{ boleta_form.fecha_emision.errors }}
					<label for="id_carrera">Carrera:</label>
					<input type="text" name="carrera" id="id_carrera" readonly="readonly"/>
				</div>
				<div class="subcl type-text">
					{{ ciclo_seccion.errors }}
					<label for="id_saldo">Ciclo - Seccion:</label>
					<input type="text" name="ciclo_seccion" id="id_ciclo_seccion" readonly="readonly"/>
				</div>
				<div class="subcl type-text">
					{{ turno.errors }}
					<label for="id_saldo">Turno:</label>
					<input type="text" name="turno" id="id_turno" readonly="readonly"/>
				</div>
				<div class="subcl type-text">
					{{ boleta_form.fecha_emision.errors }}
					<label for="id_contro_pago">Control Pago:</label>
					<input type="text" name="contro_pago" id="id_contro_pago" readonly="readonly"/>
				</div>
			</div>
		</div>
		<input type="hidden" name="monto_pension" id="id_monto_pension" value="0"/>
		</fieldset>
		<fieldset>
			<legend>Subsanar</legend>
			<div id="imprimir" class="subcolumns">
				<div class="c50l">
					<div class="subcl type-select">
						{{ boleta_form.fecha_emision.errors }}
						<label for="id_curso">Curso:</label>
						<select name="curso" id="curso">
						</select>
					</div>
				</div>
				<div class="c50r">
					<div class="subcl type-select">
						{{ boleta_form.fecha_emision.errors }}
						<label for="id_docente">Docente:</label>
						<select name="docente" id="docente">
							{% for docente in docentes %}
							<option value='{{ docente.id }}'>{{ docente }}</option>
							{% endfor %}
						</select>
					</div>
				</div>
			</div>
			<input type="hidden" name="monto_pension" id="id_monto_pension" value="0"/>
		</fieldset>
		<div class="type-button">
			<input type="reset" value="Nuevo" class="reset" id="reset" name="reset" />
			<input type="submit" value="Imprimir" class="submit" id="submit" name="submit" />
		</div>
	</form>
{% endblock %}
{% block left-bar %}
    {% include "home/pago.html" %}
{% endblock %}
{% block scriptjs %}
	<script src="{{ STATIC_URL  }}js/base.js" type="text/javascript"></script>
	<script src="{{ STATIC_URL }}js/boleta.js" type="text/javascript"></script>
	<script src="{{ STATIC_URL  }}js/jquery.selectboxes.js" type="text/javascript"></script>
	<script>
		var txtfecha = null;
		var precio_pension = null;
		var saldo = null;
		var fecha_emision = new Date();
		var meses = new Array("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic");
		var codigo = null;
		var precio_pension = null;
		$(document).ready(function() {
			run();
			txtfecha = $("#id_fecha_emision");
			saldo = $("#id_saldo");
			$("#id_contro_pago").val(meses[fecha_emision.getMonth()]+" "+fecha_emision.getYear().toString().substr(0,2))
			codigo = $("#id_codigo_alumno").focus();
			$( "#id_alumno" ).autocomplete({
				source: "/boleta/boleta-alumno-campus/json/",
				select: function( event, ui ) {
					getCampus(ui.item.id);
				},
				minLength: 2,
			});
			getFechaHora();
		});
		function getFechaHora(){
			fecha_emision=new Date();
			txtfecha.val(fecha_emision.getDate()+"/"+(fecha_emision.getMonth()+1)+"/"+fecha_emision.getFullYear()+" "+fecha_emision.getHours()+":"+fecha_emision.getMinutes()+":"+fecha_emision.getUTCSeconds());
			setTimeout(getFechaHora,1000);
		}
		function getCampus(codigo_alumno){
			$.getJSON("/boleta/boleta-campus/"+codigo_alumno+"/json/",function(data){
				codigo.val(data.codigo)
				$("#id_alumno").val(data.alumno);
				$("#id_ciclo_seccion").val(data.ciclo_seccion);
				$("#id_turno").val(data.turno);
				$("#id_carrera").val(data.carrera);
				saldo.val(data.precio_pension);
				$("#id_importe").focus();
				precio_pension = data.precio_pension
				getCursos(codigo.val());
			});
		}
		function getCursos(codigo){
			$.getJSON("/calificacion/cursos-desaprobado/"+codigo+"/json/",function(data){
				$("#curso").addOption(data, );
			});
			
		}
		function setSaldo(importe){
			if(importe=="")
				importe=0
			saldo.val(Number(precio_pension)-Number(importe));
		}
	</script>
{% endblock %}


<!--

        <script type="text/javascript">
        	var asignaturas=null;
        	var academicomenu=null;
        	var sciclo = null;
        	var dluamnos = null;
        	var talumnos = null;
        	var dluamnosm = null;
        	var tbalumnos_ma = null;
        	var divcont=null;
        	var pagomenu=null;
        	var txtfecha=null;
        	var monto_pension=null;
        	var saldo=null;
        	var fecha_emision=new Date();
        	var meses=new Array("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic");
        	$(document).ready(function() {
        	    asignaturas=$("#asignaturas");
        	    divcont=$("#col3_content");
        	    txtfecha=$("#id_fecha_emision");
        		sciclo = $("#id_ciclo");
        		monto_pension=$("#id_monto_pension");
        		curso=$("#curso");
        		saldo=$("#id_saldo");
                $("#id_contro_pago").val(meses[fecha_emision.getMonth()]+" "+fecha_emision.getYear().toString().substr(0,2))
        		$("#id_codigo_alumno").focus();
        		$( "#anadir_aula" ).button({
        			text: false,
        			icons: {
        				primary: "ui-icon-circle-plus"
        			}
        		}).click(function(){
        		    getAlumnosMatriculados();
        		});
        		$("#anadir").button({
        		    text:false,
        		    icons:{
        		        primary: "ui-icon-check"
        		    }
        		}).click(function(){
        		    anadirAlumnos(tbalumnos_no);
        		});
				$('#hierarchybreadcrumb').menu({
					content: $('#hierarchybreadcrumb').next().html(),
					backLink: false
				});
				sciclo.change(function(){
                    asignaturas.html($.ajax({
                        url: "/wvb/ajax/asignaturas/"+this.value+"/",dataType: "html",async: false
                    }).responseText);
                });
				$("#id_carrera option[value=1]").attr("selected",true);
				$("#id_carrera").change(function() {
				    sciclo.removeOption(/./);
                    sciclo.ajaxAddOption("/wvb/json/ciclo/"+this.value ,{}, true, sortoptions, [{"dir":"asc"}]);
                });
                getFechaHora();
                //imprimir();
        	});
        	function anadirAlumnos(tabla){
        	    $.each(tabla.find("tbody tr"),function(){
        	        if(this.cells[3].childNodes.item(0).checked){
        	            talumnos.find("tbody").append(this);
        	        }
        	    });
        	    dluamnos.dialog( "close" );
        	}
        	function confirmar(){
                if (confirm("¿Esta seguro que desea imprimir la boleta?"))
                    return true;
                return false;
        	}
        	function sortoptions(sort){
            	var $this = $(this);
            	$this.sortOptions(sort.dir == "asc" ? true : false);
            	sciclo.change();
            }
            function getAcademicoMenu(){
        		if(academicomenu==null)
        			academicomenu = $.ajax({
        				url: "/wvb/include/menuacademico",dataType: "html",async: false
        			}).responseText;
        		divcont.html(academicomenu);
    			menuacademico();
        	}
        	function menuacademico(){
				$('#hierarchybreadcrumb').menu({
					content: $('#hierarchybreadcrumb').next().html(),
					backLink: false
				});
			}
			function getFechaHora(){
			    fecha_emision=new Date();
			    txtfecha.val(fecha_emision.getDate()+"/"+(fecha_emision.getMonth()+1)+"/"+fecha_emision.getFullYear()+" "+fecha_emision.getHours()+":"+fecha_emision.getMinutes()+":"+fecha_emision.getUTCSeconds());
			    setTimeout(getFechaHora,1000);
			}
			function getCampus(codigo_alumno){
        	 $.getJSON("/wvb/json/nota_boleta_json/"+codigo_alumno+"/",function(data){
	            $("#id_alumno").val(data.alumno);
	            $("#id_ciclo_seccion").val(data.ciclo_seccion);
	            $("#id_turno").val(data.turno==="1" ? "Mañana":data.turno==="2" ? "Tarde":"Noche");
	            monto_pension.val(data.monto_pension);
	            $("#id_carrera").val(data.carrera);
	            $("#id_monto").focus();
	            $.each(data.notas,function(key,value){
					curso.append("<option value='"+key+"'>"+value+"</option>");
				});
			 });
        	}
			function getAcademicoMenu(){
        		if(academicomenu==null)
        			academicomenu = $.ajax({
        				url: "/wvb/include/menuacademico",dataType: "html",async: false
        			}).responseText;
        		divcont.html(academicomenu);
    			menuacademico();
        	}
        	function getPagoMenu(){
        		if(pagomenu==null)
        			pagomenu = $.ajax({
        				url: "/wvb/include/menupago",dataType: "html",async: false
        			}).responseText;
        		divcont.html(pagomenu);
    			menuacademico();
        	}
        </script>
-->

{% extends 'base.html' %}
{% block title %}W.V.B. - Historial Boletas{% endblock %}
{% block csspage %}
	<style>
		#id_alumno{
			width: 97.8%;
		}
	</style>
{% endblock %}
{% block content %}
	<form method="post" action="#" class="yform full" role="application">
		{% csrf_token %}
		<fieldset>
			<legend>Pagos Realizados</legend>
			<div class="subcolumns">
				<div id="tabs">
					<ul>
						<li><a href="#tabs-1">Hoy</a></li>
						<li><a href="#tabs-2">Por Fecha</a></li>
					</ul>
					<div id="tabs-1">
						<div class="subcolumns">
							<table id="tb_boletas">
								<thead>
									<tr>
										<th>Serie - Número</th>
										<th>Alumno</th>
										<th>Concepto</th>
										<th>Monto</th>
										<th>Válido</th>
									</tr>
								</thead>
								<tbody>
									{% for boleta in boletas %}
									<tr>
										<td>{{ boleta }}</td>
										<td>{{ boleta.alumno }}</td>
										<td>{{ boleta.concepto }}</td>
										<td>S/. {{ boleta.monto }}</td>
										<td><input type="checkbox" checked={{ boleta.valido }}/></td>
									</tr>
									{% endfor %}
								</tbody>
								<tfoot>
									<tr>
										<th>Total</th>
										<th colspan="4"><label id="id_total"></label></th>
									</tr>
								</tfoot>
							</table>
						</div>
					</div>
					<div id="tabs-2">
						<div class="c33l">
							<div class="subcl type-text">
								<label for="id_fecha_inicio">Fecha Inicio:</label>
								<input type="text" id="id_fecha_inicio" name="codigo_alumno" maxlength="6" onkeypress="if(event.keyCode==13){getCampus(this.value);return false;}"/>
							</div>
						</div>
						<div class="c33l">
							<div class="subcl type-text">
								{{ serie.errors }}
								<label for="id_fecha_fin">Fecha Fin:</label>
								<input type="text" id="id_fecha_fin" name="codigo_boleta" value=""readonly="readonly"/>
							</div>
						</div>
						<div class="c33l" style='height: 100%;'>
							<div class="type-button">
								<input type="button" value="Actualizar" class="button" id="hoy" name="hoy" onclick="getBoletasDate();"/>
							</div>
						</div>
						<div class="subcolumns">
							<table id="tb_boletas_date">
								<thead>
									<tr>
										<th>Serie - Número</th>
										<th>Alumno</th>
										<th>Concepto</th>
										<th>Monto</th>
										<th>Válido</th>
									</tr>
								</thead>
								<tbody>
								</tbody>
								<tfoot>
									<tr>
										<th>Total</th>
										<th colspan="4"><label id="id_total_date"></label></th>
									</tr>
								</tfoot>
							</table>
						</div>
					</div>
				</div>
			</div>
			<div class="type-button">
				<input type="button" value="Imprimir" class="button" id="imprimir" name="imprimir" />
			</div>
		</fieldset>
	</form>
{% endblock %}
{% block left-bar %}
    {% include "home/pago.html" %}
{% endblock %}
{% block scriptjs %}
	<script src="{{ STATIC_URL }}js/base.js" type="text/javascript"></script>
	<script src="{{ STATIC_URL }}js/boleta.js" type="text/javascript"></script>
	<script>
		var meses = new Array("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic");
		var fecha_emision = new Date({{ boleta.fecha_emision__year }});
		$(document).ready(function() {
			run();
			$("#bt_imprimir").button({
				text:true,
				icons:{
					primary: "ui-icon-print"
				}
			}).click(function(){
				imprimir();
			});
			$("#id_contro_pago").val(meses[fecha_emision.getMonth()]+" "+fecha_emision.getYear().toString().substr(0,2))
		});
	</script>
	
	
	
		<script src="{{ STATIC_URL }}js/jquery.selectboxes.js" type="text/javascript"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.tablesorter.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.uitablefilter.js"></script>
        <script type="text/javascript">
        	var academicomenu=null;
        	var talumnos = null;
        	var divcont=null;
        	var saldo=null;
        	var fecha_emision=new Date();
        	var fecha_inicio = null;
        	var fecha_fin = null;
        	var meses=new Array("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic");
        	var tboletas = null;
        	var tboletasdate = null;
        	$(document).ready(function() {
        	    divcont=$("#col3_content");
        	    tboletas = $("#tb_boletas");
        	    tboletasdate = $("#tb_boletas_date");
        	    $("#tabs").tabs();
        	    $("#tb_boletas").tablesorter();
        		fecha_inicio = $("#id_fecha_inicio").datepicker({
					changeMonth: true,
					changeYear: true, 
					closeText: 'X',
					dayNamesMin: ['Do', 'Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'Sa'],
					gotoCurrent: true,
					monthNamesShort: ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'],
					yearRange: '1988:'+fecha_emision.getFullYear(),
					dateFormat: 'mm/dd/yy',
					currentText: 'Now',
					onSelect: function(dateText, inst) {
						fecha_fin.datepicker("option", "minDate", fecha_inicio.datepicker("getDate"));
						}
					}
				);
        	    fecha_fin = $("#id_fecha_fin").datepicker({
					changeMonth: true,
					changeYear: true, 
					closeText: 'X',
					dayNamesMin: ['Do', 'Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'Sa'],
					gotoCurrent: true,
					monthNamesShort: ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'],
					yearRange: '1988:'+fecha_emision.getFullYear(),
					dateFormat: 'mm/dd/yy', 
					currentText: 'Now'}
					);
				$('#hoy').click(function(){hoy=true;});
                //imprimir();
                sumarMontosHoy();
        	});
			function getBoletas(){
        	 $.getJSON("/wvb/json/boletas/nodate-nodate-"+1+"-"+tboletas.find("tbody tr").length,
        	 function(data){
	            $.each(data,function(key,value){
					if(value.serienumero != "0"){
						var tr = $("<tr></tr>")
						var chk = $("<input type='checkbox'/>")
						tr.append("<td>"+value.serienumero+"</td>");
						tr.append("<td>"+value.alumno+"</td>");
						tr.append("<td>"+value.concepto+"</td>");
						tr.append("<td>S/. "+value.monto+"</td>");
						if(value.valido)
							chk.attr("checked","checked");
						tr.append($("<td></td>").append(chk));
						tr.prependTo("#tb_boletas > tbody");
        	        }
        	    });
        	    tboletas.tablesorter();
        	    sumarMontosHoy();
			 });
        	}
        	function getBoletasDate(){
        	 var fecha_inicio=$("#id_fecha_inicio").val().replace(/[/]/g,"");;
        	 var fecha_fin=$("#id_fecha_fin").val().replace(/[/]/g,""); 	 
        	 if(fecha_inicio!="" && fecha_fin!=""){
        	 $.getJSON("/wvb/json/boletas/"+fecha_inicio+"-"+fecha_fin+"-"+0+"-"+tboletas.find("tbody tr").length,
        	 function(data){
				 tboletasdate.find("tbody tr:not(:first)").remove();
	            $.each(data,function(key,value){
					if(value.serienumero != "0"){
						var tr = $("<tr></tr>")
						var chk = $("<input type='checkbox'/>")
						tr.append("<td>"+value.serienumero+"</td>");
						tr.append("<td>"+value.alumno+"</td>");
						tr.append("<td>"+value.concepto+"</td>");
						tr.append("<td>S/. "+value.monto+"</td>");
						if(value.valido)
							chk.attr("checked","checked");
						tr.append($("<td></td>").append(chk));
						tboletasdate.append(tr);
        	        }
        	    });
        	    tboletasdate.tablesorter();
        	    sumarMontosDate();
			 });
			 }
        	}
        	function sumarMontosHoy(){
				var total = 0;
				$.each(tboletas.find("tbody tr"), function(){
					if(this.cells[4].childNodes.item(0).checked){
						total+=parseFloat(this.cells[3].childNodes.item(0).data.toString().replace("S/. ",""));
					}
				});
				$("#id_total").html("S/. "+total)
			}
			function sumarMontosDate(){
				var total = 0;
				$.each(tboletasdate.find("tbody tr"), function(){
					if(this.cells[4].childNodes.item(0).checked){
						total+=parseFloat(this.cells[3].childNodes.item(0).data.toString().replace("S/. ",""));
					}
				});
				$("#id_total_date").html("S/. "+total)
			}
        	//setInterval(getBoletas,60000);
        </script>

{% endblock %}





